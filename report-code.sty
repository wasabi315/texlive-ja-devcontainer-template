\usepackage{listings}

% common settings -------------------------------------------------------------

\lstset{ 
  basicstyle=\ttfamily\footnotesize,
  breaklines=true,
  extendedchars=true,
  frame=single,
  keepspaces=true,
  showspaces=false,
  showstringspaces=false,
}

\newcounter{oldlstlisting}

% code ------------------------------------------------------------------------

\lstdefinestyle{code}{
  numbers=left,
  numbersep=10pt,
  commentstyle=\itshape,
  keywordstyle=\bfseries,
}

\newcounter{code}

\lstnewenvironment{code}[1][]{
  \renewcommand*{\lstlistingname}{Code}
  \setcounter{oldlstlisting}{\value{lstlisting}}
  \setcounter{lstlisting}{\value{code}}
  \lstset{style=code, #1}
}{
  \stepcounter{code}
  \setcounter{lstlisting}{\value{oldlstlisting}}
}

\newcommand{\includecode}[2][]{
  \begin{@empty}
    \renewcommand*{\lstlistingname}{Code}
    \setcounter{oldlstlisting}{\value{lstlisting}}
    \setcounter{lstlisting}{\value{code}}
    \lstinputlisting[caption=#2, style=code, #1]{#2}
    \stepcounter{code}
    \setcounter{lstlisting}{\value{oldlstlisting}}
  \end{@empty}
}

% command line ----------------------------------------------------------------

\lstdefinestyle{commandline}{
  frameround=tttt,
  lineskip=0.75ex
}

\newcounter{commandline}

\lstnewenvironment{commandline}[1][]{
  \renewcommand*{\lstlistingname}{Command line}
  \setcounter{oldlstlisting}{\value{lstlisting}}
  \setcounter{lstlisting}{\value{commandline}}
  \lstset{style=commandline, #1}
}{
  \stepcounter{commandline}
  \setcounter{lstlisting}{\value{oldlstlisting}}
}
